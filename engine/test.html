<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="script_common_debug.js"></script>
	<script type="text/javascript" src="script_parse.js"></script>
	<script type="text/javascript" src="script_exec.js"></script>
	<script type="text/javascript">
	function arrayToString(array) {
		let ret = '';
		array.forEach(function(a) {
			if (ret) {
				ret = ret + ', ';
			}
			if (a.v.type === TYPE_ARRAY) {
				ret += '{' + arrayToString(a.v.array) + '}';
			} else {
				ret += ScriptExec.getValueString(a.v);
			}
		});
		return ret;
	}
	function exec() {
		document.getElementById('result').innerHTML = '';
		const buf = document.getElementById('src').value;
		const sp = new ScriptParse({extension: true, strict_val: false});
		sp.parse(buf, {
			success: function(token) {
				console.log(token);
				if (token) {
					const ep = new ScriptExec({extension: sp.extension, strict_val: sp.strict_val});
					ep.exec(token, {}, {
						success: function(value) {
							if (value) {
								if (value.type === TYPE_INTEGER || value.type === TYPE_FLOAT) {
									document.getElementById('result').innerHTML = 'Success: ' + value.num;
								} else if (value.type === TYPE_STRING) {
									document.getElementById('result').innerHTML = 'Success: ' + value.str;
								} else if (value.type === TYPE_ARRAY) {
									document.getElementById('result').innerHTML = 'Success: {' + arrayToString(value.array) + '}';
								}
							} else {
								document.getElementById('result').innerHTML = 'Success';
							}
						},
						error: function(error) {
							document.getElementById('result').innerHTML = 'Exec Error: ' + error.msg + ' (' + (error.line + 1) + ')';
						}
					});
				}
			},
			error: function(error) {
				document.getElementById('result').innerHTML = 'Parse Error: ' + error.msg + ' (' + (error.line + 1) + ')';
			}
		});
	}
	</script>
</head>
<body>

<textarea id="src" style="width:350px;height:200px;">
function aaa(i, j, x=5) {
  return i + j + x
}
exit aaa(1,2)
</textarea>
<div><input type="button" value="Exec" onclick="exec();"></input></div>
<div>Result: <span id="result"></span></div>

</body>
</html>

